<!DOCTYPE html>
<html lang="<%= locale %>">
<head>
    <!-- Meta Tags -->
    <title>
        <%= t("meta.title") %>
    </title>
    <%- include('Partials/meta') %>
    <%- include('Partials/links') %>
</head>

<body data-spy="scroll" data-target=".navbar" data-offset="90">
    <!--PreLoader-->
    <div class="loader">
        <div class="loader-spinner"></div>
    </div>
    <!--PreLoader Ends-->
    <!-- header -->
    <%- include('Partials/header') %>
        <!-- header -->

        <!--MAIN SLIDER START-->
        <div id="slider-section" class="slider-section center-form d-flex justify-content-center">
            <!-- START REVOLUTION SLIDER 5.4.1 fullwidth mode -->

            <ul class="bg">
                <li>
                    <div class="tp-caption tp-resizeme"
                        data-frames='[{"from":"y:[100%];z:0;rX:0deg;rY:0;rZ:0;sX:1;sY:1;skX:0;skY:0;opacity:0;","mask":"x:0px;y:[100%];s:inherit;e:inherit;","speed":1100,"to":"o:1;","delay":0,"ease":"Power4.easeInOut"},{"delay":"wait","speed":0,"to":"y:[100%];","mask":"x:inherit;y:inherit;s:inherit;e:inherit;","ease":"Power2.easeInOut"}]'>
                        <form action="register" method="POST" id="registerForm">
                            <h1>
                                <%= t("register.title") %>
                            </h1>
                            <br>
                            <input type="hidden" name="recaptchaToken" id="recaptchaToken" />
                            <input name="name" placeholder="<%= t('register.form.name') %>"><br>
                            <input name="surname" placeholder="<%= t('register.form.surname') %>"><br>
                            <input name="email" placeholder="<%= t('register.form.email') %>"><br>
                            <input name="pass" type="password" placeholder="<%= t('register.form.password') %>"><br>

                            <br>

                            <input type="submit" value="<%= t('register.form.submit') %>">
                        </form>
                        <div class="output-message">
                            <% if (typeof success !="undefined" && success) { %>
                                <div class="success">
                                    <p>
                                        <%= message %>
                                    </p>
                                </div>
                                <% } else if (typeof success !="undefined" && !success) { %>
                                    <div class="error">
                                        <p>
                                            <%= message %>
                                        </p>
                                    </div>
                                    <% } %>
                        </div>
                    </div>
                </li>
            </ul>

            <ul class="social-icons social-icons-simple white d-none d-md-block d-lg-block social-left">
                <li class="d-table"><a href="javascript:void(0)"><i class="i-col fab fa-facebook-f"></i></a> </li>
                <li class="d-table"><a href="javascript:void(0)"><i class="i-col fab fa-twitter"></i> </a> </li>
                <li class="d-table"><a href="javascript:void(0)"><i class="i-col fab fa-linkedin-in"></i> </a> </li>
                <li class="d-table"><a href="javascript:void(0)"><i class="i-col fab fa-instagram"></i> </a> </li>
            </ul>
        </div>
        <!--Main SLIDER END -->
        <%- include('Partials/footer') %>
        
        <script>
            
            function ensureRecaptchaReady(maxWaitMs = 5000) {
                return new Promise((resolve, reject) => {
                    const start = Date.now();
                    (function check() {
                        if (window.grecaptcha && typeof grecaptcha.ready === 'function') {
                            grecaptcha.ready(resolve);
                        } else if (Date.now() - start < maxWaitMs) {
                            setTimeout(check, 100);
                        } else {
                            reject(new Error('reCAPTCHA not loaded'));
                        }
                    })();
                });
            }

            window.addEventListener('DOMContentLoaded', () => {
                const form = document.getElementById('registerForm');
                form.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    try {
                        await ensureRecaptchaReady();
                        const token = await grecaptcha.execute("6LfLBKArAAAAAG51qspdZnp0OWcHzTHXa-tDHAob", { action: 'login' });
                        document.getElementById('recaptchaToken').value = token;
                        form.submit();
                    } catch (err) {
                        console.error(err);
                        alert('reCAPTCHA yüklenemedi, lütfen sayfayı yenileyip tekrar deneyin.');
                    }
                });
            });
        </script>
</body>


</html>